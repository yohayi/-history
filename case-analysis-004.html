<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PHP后端API接口设计 - 案例004</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: linear-gradient(135deg, #2c3e50, #1a1a2e);
            color: white;
            padding: 1.5rem 0;
            margin-bottom: 2rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 6px;
            background-color: rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .case-header {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .case-id {
            display: inline-block;
            background-color: #e9ecef;
            color: #495057;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .case-title {
            font-size: 2.2rem;
            color: #2c3e50;
            margin-bottom: 10px;
        }
        
        .case-meta {
            display: flex;
            gap: 20px;
            color: #666;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .case-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .case-tags {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .tag {
            background-color: #e5dbff;
            color: #5f3dc4;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .tag.php { background-color: #e5dbff; color: #5f3dc4; }
        .tag.api { background-color: #d3f9d8; color: #2b8a3e; }
        .tag.restful { background-color: #e7f5ff; color: #1971c2; }
        .tag.security { background-color: #ffe3e3; color: #c92a2a; }
        .tag.performance { background-color: #fff3bf; color: #e67700; }
        
        .content-section {
            background-color: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        .section-title {
            font-size: 1.6rem;
            color: #2c3e50;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .hint-box {
            background-color: #e5dbff;
            border-left: 4px solid #5f3dc4;
            padding: 20px;
            border-radius: 6px;
            margin-bottom: 25px;
        }
        
        .hint-title {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            color: #5f3dc4;
        }
        
        .hint-title i {
            font-size: 1.2rem;
        }
        
        .code-block {
            background-color: #1e1e1e;
            color: #d4d4d4;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.95rem;
            line-height: 1.5;
        }
        
        .code-comment { color: #6a9955; }
        .code-keyword { color: #569cd6; }
        .code-function { color: #dcdcaa; }
        .code-string { color: #ce9178; }
        .code-number { color: #b5cea8; }
        .code-variable { color: #9cdcfe; }
        .code-operator { color: #d4d4d4; }
        
        .design-principles {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .principle-card {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            border-left: 4px solid #5f3dc4;
            transition: all 0.3s;
        }
        
        .principle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .principle-card h4 {
            color: #2c3e50;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .http-methods {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 25px 0;
        }
        
        .method-badge {
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .method-get { background-color: #d3f9d8; color: #2b8a3e; }
        .method-post { background-color: #e7f5ff; color: #1971c2; }
        .method-put { background-color: #fff3bf; color: #e67700; }
        .method-delete { background-color: #ffe3e3; color: #c92a2a; }
        .method-patch { background-color: #e5dbff; color: #5f3dc4; }
        
        .api-examples {
            margin: 25px 0;
        }
        
        .api-example {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            border-left: 4px solid #1971c2;
        }
        
        .api-example h4 {
            color: #1971c2;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .response-example {
            background-color: #1e1e1e;
            color: #d4d4d4;
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .analysis-list {
            list-style-type: none;
            padding-left: 0;
        }
        
        .analysis-list li {
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: flex-start;
            gap: 15px;
        }
        
        .analysis-list li:last-child {
            border-bottom: none;
        }
        
        .list-icon {
            color: #5f3dc4;
            font-size: 1.2rem;
            margin-top: 3px;
        }
        
        .security-checklist {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }
        
        .checklist-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 12px;
            background-color: #f8f9fa;
            border-radius: 6px;
        }
        
        .checklist-item i.fa-check {
            color: #2b8a3e;
        }
        
        .checklist-item i.fa-times {
            color: #c92a2a;
        }
        
        .related-cases {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }
        
        .related-case {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
            transition: all 0.3s;
            text-decoration: none;
            color: inherit;
            display: block;
        }
        
        .related-case:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
        }
        
        .related-case h4 {
            margin-bottom: 10px;
            color: #2c3e50;
        }
        
        .interactive-demo {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            margin: 25px 0;
        }
        
        .demo-tabs {
            display: flex;
            border-bottom: 1px solid #e0e0e0;
            margin-bottom: 20px;
            overflow-x: auto;
        }
        
        .demo-tab {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: #666;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .demo-tab.active {
            color: #5f3dc4;
            border-bottom-color: #5f3dc4;
        }
        
        .demo-content {
            display: none;
        }
        
        .demo-content.active {
            display: block;
        }
        
        .demo-code {
            background-color: #1e1e1e;
            color: #d4d4d4;
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto;
            font-family: 'Courier New', Courier, monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .demo-preview {
            background-color: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            min-height: 200px;
        }
        
        .demo-preview h3 {
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .status-code-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .status-code {
            padding: 10px;
            border-radius: 6px;
            font-weight: 600;
            text-align: center;
        }
        
        .status-2xx { background-color: #d3f9d8; color: #2b8a3e; }
        .status-4xx { background-color: #fff3bf; color: #e67700; }
        .status-5xx { background-color: #ffe3e3; color: #c92a2a; }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
            color: #666;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .case-title {
                font-size: 1.8rem;
            }
            
            .content-section {
                padding: 20px;
            }
            
            .related-cases {
                grid-template-columns: 1fr;
            }
            
            .design-principles {
                grid-template-columns: 1fr;
            }
            
            .security-checklist {
                grid-template-columns: 1fr;
            }
            
            .demo-tabs {
                flex-wrap: wrap;
            }
            
            .demo-tab {
                flex: 1;
                min-width: 120px;
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <a href="index.html" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                    返回主页面
                </a>
                <div>
                    <h1>历史记录分析系统</h1>
                    <p style="opacity: 0.85; margin-top: 5px;">案例详细分析</p>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <div class="case-header">
            <span class="case-id">REC004</span>
            <h1 class="case-title">PHP后端API接口设计</h1>
            <div class="case-meta">
                <div class="case-meta-item">
                    <i class="far fa-calendar"></i>
                    <span>创建日期: 2023-09-28</span>
                </div>
                <div class="case-meta-item">
                    <i class="fas fa-tags"></i>
                    <span>标签:</span>
                </div>
            </div>
            <div class="case-tags">
                <span class="tag php">php</span>
                <span class="tag api">api</span>
                <span class="tag restful">restful</span>
                <span class="tag security">安全</span>
                <span class="tag performance">性能</span>
            </div>
        </div>
        
        <div class="content-section">
            <div class="hint-box">
                <div class="hint-title">
                    <i class="fas fa-lightbulb"></i>
                    <h3>案例暗示分析</h3>
                </div>
                <p>这个案例展示了PHP后端API接口设计中的关键问题与最佳实践。分析发现，许多PHP后端API在安全性、性能和维护性方面存在问题，主要是由于缺乏统一的设计标准和架构规范。本案例提供了完整的RESTful API设计原则、安全防护措施和性能优化策略。</p>
            </div>
            
            <h2 class="section-title">RESTful API设计核心原则</h2>
            
            <div class="design-principles">
                <div class="principle-card">
                    <h4><i class="fas fa-exchange-alt"></i> 统一接口</h4>
                    <p>使用标准的HTTP方法和状态码，保持接口的一致性。所有资源通过URI标识，使用JSON作为数据交换格式。</p>
                </div>
                
                <div class="principle-card">
                    <h4><i class="fas fa-server"></i> 无状态性</h4>
                    <p>每个请求包含处理所需的所有信息，服务器不存储客户端状态。会话状态完全由客户端维护。</p>
                </div>
                
                <div class="principle-card">
                    <h4><i class="fas fa-layer-group"></i> 分层系统</h4>
                    <p>客户端不需要知道是否直接连接到最终服务器。中间层可以提高系统的可扩展性和安全性。</p>
                </div>
                
                <div class="principle-card">
                    <h4><i class="fas fa-code"></i> 可缓存性</h4>
                    <p>响应必须明确标定为可缓存或不可缓存，以提高性能。合理使用HTTP缓存头控制缓存策略。</p>
                </div>
                
                <div class="principle-card">
                    <h4><i class="fas fa-puzzle-piece"></i> 按需编码</h4>
                    <p>服务器可以临时扩展或自定义客户端功能，通过传输可执行代码实现（可选原则）。</p>
                </div>
                
                <div class="principle-card">
                    <h4><i class="fas fa-box-open"></i> 资源导向</h4>
                    <p>一切皆资源，通过URI标识。使用合适的HTTP方法对资源进行操作，返回标准化的响应格式。</p>
                </div>
            </div>
            
            <h3 style="margin: 25px 0 15px; color: #495057;">HTTP方法使用规范</h3>
            <div class="http-methods">
                <div class="method-badge method-get">
                    <i class="fas fa-download"></i>
                    GET - 获取资源
                </div>
                <div class="method-badge method-post">
                    <i class="fas fa-plus"></i>
                    POST - 创建资源
                </div>
                <div class="method-badge method-put">
                    <i class="fas fa-edit"></i>
                    PUT - 更新资源
                </div>
                <div class="method-badge method-patch">
                    <i class="fas fa-wrench"></i>
                    PATCH - 部分更新
                </div>
                <div class="method-badge method-delete">
                    <i class="fas fa-trash"></i>
                    DELETE - 删除资源
                </div>
            </div>
        </div>
        
        <div class="content-section">
            <h2 class="section-title">API设计模式与代码示例</h2>
            
            <div class="api-examples">
                <div class="api-example">
                    <h4><i class="fas fa-user-circle"></i> 用户管理API示例</h4>
                    <p>良好的RESTful设计应使用清晰的资源路径和合适的HTTP方法：</p>
                    
                    <div class="code-block">
<span class="code-comment">// 用户资源API端点设计</span><br>
<span class="code-comment">// GET /api/v1/users - 获取用户列表</span><br>
<span class="code-comment">// GET /api/v1/users/{id} - 获取特定用户</span><br>
<span class="code-comment">// POST /api/v1/users - 创建新用户</span><br>
<span class="code-comment">// PUT /api/v1/users/{id} - 更新用户信息</span><br>
<span class="code-comment">// DELETE /api/v1/users/{id} - 删除用户</span><br><br>

<span class="code-comment">// PHP实现示例 (使用Laravel框架风格)</span><br>
<span class="code-keyword">class</span> UserController <span class="code-keyword">extends</span> Controller {<br>
&nbsp;&nbsp;<span class="code-comment">// 获取用户列表</span><br>
&nbsp;&nbsp;<span class="code-keyword">public</span> <span class="code-function">function</span> <span class="code-function">index</span>(Request $request) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;$perPage = $request-><span class="code-function">get</span>(<span class="code-string">'per_page'</span>, <span class="code-number">15</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;$users = User::<span class="code-function">paginate</span>($perPage);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> response()-><span class="code-function">json</span>([<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'data'</span> => $users-><span class="code-function">items</span>(),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'meta'</span> => [<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'total'</span> => $users-><span class="code-function">total</span>(),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'per_page'</span> => $users-><span class="code-function">perPage</span>(),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'current_page'</span> => $users-><span class="code-function">currentPage</span>()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;]<br>
&nbsp;&nbsp;&nbsp;&nbsp;]);<br>
&nbsp;&nbsp;}<br><br>
&nbsp;&nbsp;<span class="code-comment">// 创建新用户</span><br>
&nbsp;&nbsp;<span class="code-keyword">public</span> <span class="code-function">function</span> <span class="code-function">store</span>(CreateUserRequest $request) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// 验证请求数据</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;$validated = $request-><span class="code-function">validated</span>();<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// 创建用户</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;$user = User::<span class="code-function">create</span>([<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'name'</span> => $validated[<span class="code-string">'name'</span>],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'email'</span> => $validated[<span class="code-string">'email'</span>],<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'password'</span> => Hash::<span class="code-function">make</span>($validated[<span class="code-string">'password'</span>])<br>
&nbsp;&nbsp;&nbsp;&nbsp;]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> response()-><span class="code-function">json</span>([<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'data'</span> => $user,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'message'</span> => <span class="code-string">'用户创建成功'</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;], <span class="code-number">201</span>); <span class="code-comment">// 201 Created</span><br>
&nbsp;&nbsp;}<br>
}
                    </div>
                    
                    <div class="response-example">
{
  "data": {
    "id": 123,
    "name": "张三",
    "email": "zhangsan@example.com",
    "created_at": "2023-09-28T10:30:00Z"
  },
  "message": "用户创建成功"
}
                    </div>
                </div>
                
                <div class="api-example">
                    <h4><i class="fas fa-exclamation-triangle"></i> 错误处理标准化</h4>
                    <p>统一的错误响应格式有助于客户端处理异常情况：</p>
                    
                    <div class="code-block">
<span class="code-comment">// 统一的错误响应格式</span><br>
<span class="code-keyword">public</span> <span class="code-function">function</span> <span class="code-function">errorResponse</span>($message, $code, $errors = []) {<br>
&nbsp;&nbsp;<span class="code-keyword">return</span> response()-><span class="code-function">json</span>([<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'success'</span> => false,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'message'</span> => $message,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'code'</span> => $code,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'errors'</span> => $errors,<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'timestamp'</span> => now()-><span class="code-function">toISOString</span>()<br>
&nbsp;&nbsp;], $code);<br>
}<br><br>

<span class="code-comment">// 使用示例</span><br>
<span class="code-keyword">try</span> {<br>
&nbsp;&nbsp;<span class="code-comment">// 业务逻辑</span><br>
} <span class="code-keyword">catch</span> (ModelNotFoundException $e) {<br>
&nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-function">errorResponse</span>(<span class="code-string">'资源不存在'</span>, <span class="code-number">404</span>);<br>
} <span class="code-keyword">catch</span> (ValidationException $e) {<br>
&nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-function">errorResponse</span>(<span class="code-string">'参数验证失败'</span>, <span class="code-number">422</span>, $e-><span class="code-function">errors</span>());<br>
} <span class="code-keyword">catch</span> (Exception $e) {<br>
&nbsp;&nbsp;Log::<span class="code-function">error</span>($e);<br>
&nbsp;&nbsp;<span class="code-keyword">return</span> <span class="code-function">errorResponse</span>(<span class="code-string">'服务器内部错误'</span>, <span class="code-number">500</span>);<br>
}
                    </div>
                </div>
            </div>
        </div>
        
        <div class="content-section">
            <h2 class="section-title">API安全性设计</h2>
            
            <div class="security-checklist">
                <div class="checklist-item">
                    <i class="fas fa-check"></i>
                    <div>
                        <strong>输入验证</strong>
                        <p>对所有输入数据进行严格验证，使用白名单原则过滤数据。</p>
                    </div>
                </div>
                
                <div class="checklist-item">
                    <i class="fas fa-check"></i>
                    <div>
                        <strong>SQL注入防护</strong>
                        <p>使用参数化查询或ORM，避免直接拼接SQL语句。</p>
                    </div>
                </div>
                
                <div class="checklist-item">
                    <i class="fas fa-check"></i>
                    <div>
                        <strong>XSS防护</strong>
                        <p>对输出进行适当的编码，防止跨站脚本攻击。</p>
                    </div>
                </div>
                
                <div class="checklist-item">
                    <i class="fas fa-check"></i>
                    <div>
                        <strong>CSRF防护</strong>
                        <p>对状态变更请求实施CSRF令牌验证。</p>
                    </div>
                </div>
                
                <div class="checklist-item">
                    <i class="fas fa-check"></i>
                    <div>
                        <strong>认证与授权</strong>
                        <p>使用JWT、OAuth等标准协议实现安全的认证授权机制。</p>
                    </div>
                </div>
                
                <div class="checklist-item">
                    <i class="fas fa-check"></i>
                    <div>
                        <strong>速率限制</strong>
                        <p>实施API调用频率限制，防止滥用和DDoS攻击。</p>
                    </div>
                </div>
                
                <div class="checklist-item">
                    <i class="fas fa-check"></i>
                    <div>
                        <strong>HTTPS强制</strong>
                        <p>所有API调用必须通过HTTPS进行，保护数据传输安全。</p>
                    </div>
                </div>
                
                <div class="checklist-item">
                    <i class="fas fa-check"></i>
                    <div>
                        <strong>敏感数据保护</strong>
                        <p>对密码等敏感数据进行加密存储，使用bcrypt等安全哈希算法。</p>
                    </div>
                </div>
            </div>
            
            <h3 style="margin: 30px 0 15px; color: #495057;">JWT认证实现示例</h3>
            <div class="code-block">
<span class="code-comment">// JWT认证中间件示例</span><br>
<span class="code-keyword">class</span> JwtMiddleware {<br>
&nbsp;&nbsp;<span class="code-keyword">public</span> <span class="code-function">function</span> <span class="code-function">handle</span>($request, Closure $next) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;$token = $request-><span class="code-function">header</span>(<span class="code-string">'Authorization'</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">if</span> (!$token) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> response()-><span class="code-function">json</span>([<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'message'</span> => <span class="code-string">'未提供认证令牌'</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;], <span class="code-number">401</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// 移除"Bearer "前缀</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;$token = str_replace(<span class="code-string">'Bearer '</span>, <span class="code-string">''</span>, $token);<br>
&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">try</span> {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// 验证JWT令牌</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$payload = JWT::<span class="code-function">decode</span>($token, <span class="code-function">env</span>(<span class="code-string">'JWT_SECRET'</span>), [<span class="code-string">'HS256'</span>]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-comment">// 将用户信息添加到请求中</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$request-><span class="code-function">merge</span>([<span class="code-string">'user'</span> => $payload->user]);<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> $next($request);<br>
&nbsp;&nbsp;&nbsp;&nbsp;} <span class="code-keyword">catch</span> (Exception $e) {<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-keyword">return</span> response()-><span class="code-function">json</span>([<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="code-string">'message'</span> => <span class="code-string">'无效的认证令牌'</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;], <span class="code-number">401</span>);<br>
&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;}<br>
}
            </div>
        </div>
        
        <div class="content-section">
            <h2 class="section-title">HTTP状态码使用规范</h2>
            <p>正确的HTTP状态码可以帮助客户端理解请求的处理结果：</p>
            
            <div class="status-code-grid">
                <div class="status-code status-2xx">
                    <div>200 OK</div>
                    <small>请求成功</small>
                </div>
                <div class="status-code status-2xx">
                    <div>201 Created</div>
                    <small>资源创建成功</small>
                </div>
                <div class="status-code status-2xx">
                    <div>204 No Content</div>
                    <small>请求成功，无返回内容</small>
                </div>
                <div class="status-code status-4xx">
                    <div>400 Bad Request</div>
                    <small>请求参数错误</small>
                </div>
                <div class="status-code status-4xx">
                    <div>401 Unauthorized</div>
                    <small>未认证</small>
                </div>
                <div class="status-code status-4xx">
                    <div>403 Forbidden</div>
                    <small>无权限</small>
                </div>
                <div class="status-code status-4xx">
                    <div>404 Not Found</div>
                    <small>资源不存在</small>
                </div>
                <div class="status-code status-4xx">
                    <div>422 Unprocessable</div>
                    <small>参数验证失败</small>
                </div>
                <div class="status-code status-5xx">
                    <div>500 Internal Error</div>
                    <small>服务器内部错误</small>
                </div>
                <div class="status-code status-5xx">
                    <div>503 Service Unavailable</div>
                    <small>服务不可用</small>
                </div>
            </div>
        </div>
        
        <div class="content-section">
            <h2 class="section-title">交互演示：API设计与安全</h2>
            
            <div class="interactive-demo">
                <div class="demo-tabs">
                    <button class="demo-tab active" data-target="design-tab">API设计对比</button>
                    <button class="demo-tab" data-target="security-tab">安全性检查</button>
                    <button class="demo-tab" data-target="performance-tab">性能优化</button>
                </div>
                
                <div id="design-tab" class="demo-content active">
                    <p>对比良好设计与不良设计的API端点：</p>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px;">
                        <div>
                            <h4 style="color: #c92a2a; margin-bottom: 10px;">不良设计</h4>
                            <div class="demo-code" style="font-size: 0.85rem;">
<span class="code-comment">// 动作导向，非RESTful</span><br>
POST /getUser.php<br>
POST /createUser.php<br>
POST /updateUser.php<br>
POST /deleteUser.php<br><br>
<span class="code-comment">// 混合使用GET和POST</span><br>
GET /api.php?action=delete&id=123<br><br>
<span class="code-comment">// 不一致的响应格式</span><br>
{<br>
&nbsp;&nbsp;"user": {...},<br>
&nbsp;&nbsp;"success": true<br>
}<br>
{<br>
&nbsp;&nbsp;"data": {...},<br>
&nbsp;&nbsp;"status": "ok"<br>
}
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="color: #2b8a3e; margin-bottom: 10px;">良好设计</h4>
                            <div class="demo-code" style="font-size: 0.85rem;">
<span class="code-comment">// 资源导向，RESTful</span><br>
GET /api/v1/users<br>
GET /api/v1/users/{id}<br>
POST /api/v1/users<br>
PUT /api/v1/users/{id}<br>
DELETE /api/v1/users/{id}<br><br>
<span class="code-comment">// 正确的HTTP方法使用</span><br>
DELETE /api/v1/users/123<br><br>
<span class="code-comment">// 一致的响应格式</span><br>
{<br>
&nbsp;&nbsp;"data": {...},<br>
&nbsp;&nbsp;"meta": {...}<br>
}<br>
{<br>
&nbsp;&nbsp;"success": false,<br>
&nbsp;&nbsp;"message": "...",<br>
&nbsp;&nbsp;"errors": [...]<br>
}
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 6px;">
                        <h4 style="color: #495057; margin-bottom: 10px;">设计原则总结：</h4>
                        <ul style="padding-left: 20px;">
                            <li>使用名词（资源）而非动词（动作）定义端点</li>
                            <li>使用正确的HTTP方法表示操作类型</li>
                            <li>保持一致的响应格式和状态码</li>
                            <li>使用版本控制（如/v1/）管理API演进</li>
                            <li>提供清晰的错误信息和文档</li>
                        </ul>
                    </div>
                </div>
                
                <div id="security-tab" class="demo-content">
                    <div class="demo-preview">
                        <h3>API安全漏洞检查</h3>
                        <div style="margin-top: 20px;">
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <i class="fas fa-shield-alt" style="color: #2b8a3e; font-size: 1.5rem;"></i>
                                <div>
                                    <h4 style="margin-bottom: 5px;">输入验证</h4>
                                    <p>检查所有用户输入，防止SQL注入、XSS攻击。使用白名单验证而非黑名单。</p>
                                </div>
                            </div>
                            
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <i class="fas fa-key" style="color: #2b8a3e; font-size: 1.5rem;"></i>
                                <div>
                                    <h4 style="margin-bottom: 5px;">认证与授权</h4>
                                    <p>实施基于角色的访问控制（RBAC），对敏感操作进行双重验证。</p>
                                </div>
                            </div>
                            
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <i class="fas fa-tachometer-alt" style="color: #2b8a3e; font-size: 1.5rem;"></i>
                                <div>
                                    <h4 style="margin-bottom: 5px;">速率限制</h4>
                                    <p>为不同端点设置合理的请求频率限制，防止API滥用和DDoS攻击。</p>
                                </div>
                            </div>
                            
                            <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                <i class="fas fa-lock" style="color: #2b8a3e; font-size: 1.5rem;"></i>
                                <div>
                                    <h4 style="margin-bottom: 5px;">数据加密</h4>
                                    <p>敏感数据在传输和存储时都应加密，使用TLS 1.2+和强加密算法。</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="performance-tab" class="demo-content">
                    <div class="demo-preview">
                        <h3>API性能优化策略</h3>
                        <div style="margin-top: 20px;">
                            <div style="margin-bottom: 20px;">
                                <h4 style="margin-bottom: 10px;">1. 数据库优化</h4>
                                <ul style="padding-left: 20px;">
                                    <li>使用索引优化查询性能</li>
                                    <li>避免N+1查询问题，使用预加载</li>
                                    <li>合理分页，限制返回数据量</li>
                                    <li>使用缓存减少数据库压力</li>
                                </ul>
                            </div>
                            
                            <div style="margin-bottom: 20px;">
                                <h4 style="margin-bottom: 10px;">2. 响应优化</h4>
                                <ul style="padding-left: 20px;">
                                    <li>启用Gzip压缩响应数据</li>
                                    <li>使用ETag和Last-Modified头部支持缓存</li>
                                    <li>只返回客户端需要的字段（字段选择）</li>
                                    <li>压缩图片和其他媒体资源</li>
                                </ul>
                            </div>
                            
                            <div>
                                <h4 style="margin-bottom: 10px;">3. 架构优化</h4>
                                <ul style="padding-left: 20px;">
                                    <li>使用CDN分发静态资源</li>
                                    <li>实施API网关进行负载均衡</li>
                                    <li>异步处理耗时操作</li>
                                    <li>监控和日志记录性能指标</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="content-section">
            <h2 class="section-title">关键发现与最佳实践</h2>
            
            <ul class="analysis-list">
                <li>
                    <i class="fas fa-chart-line list-icon"></i>
                    <div>
                        <strong>版本控制至关重要</strong>：API版本化（如/v1/, /v2/）允许在不破坏现有客户端的情况下演进API。
                    </div>
                </li>
                <li>
                    <i class="fas fa-file-contract list-icon"></i>
                    <div>
                        <strong>文档化提高采用率</strong>：完善的API文档（如OpenAPI/Swagger）可以使API采用率提高40%以上。
                    </div>
                </li>
                <li>
                    <i class="fas fa-tachometer-alt list-icon"></i>
                    <div>
                        <strong>性能监控不可忽视</strong>：实施API性能监控可以提前发现潜在问题，减少30-50%的故障时间。
                    </div>
                </li>
                <li>
                    <i class="fas fa-user-shield list-icon"></i>
                    <div>
                        <strong>安全是持续过程</strong>：API安全需要持续评估和更新，定期进行安全审计和渗透测试。
                    </div>
                </li>
                <li>
                    <i class="fas fa-code-branch list-icon"></i>
                    <div>
                        <strong>向后兼容性</strong>：尽可能保持API的向后兼容性，或者提供足够长的弃用期。
                    </div>
                </li>
            </ul>
            
            <div style="margin-top: 25px; padding: 20px; background-color: #e7f5ff; border-radius: 8px;">
                <h4 style="color: #1971c2; margin-bottom: 10px;">实施建议</h4>
                <ol style="padding-left: 20px;">
                    <li>使用成熟的API框架（如Laravel、Lumen、Slim）加速开发</li>
                    <li>实施API网关进行统一管理、监控和安全控制</li>
                    <li>为所有API端点编写自动化测试，确保稳定性</li>
                    <li>使用API管理工具（如Postman、Insomnia）进行测试和文档生成</li>
                    <li>建立API设计规范并在团队中推广实施</li>
                </ol>
            </div>
        </div>
        
        <div class="content-section">
            <h2 class="section-title">相关案例</h2>
            <div class="related-cases">
                <a href="case-analysis-002.html" class="related-case">
                    <h4>JavaScript异步编程模式</h4>
                    <p>前端如何高效调用后端API</p>
                </a>
                <a href="case-analysis-005.html" class="related-case">
                    <h4>Python数据分析流程</h4>
                    <p>API在数据分析中的应用</p>
                </a>
                <a href="index.html" class="related-case">
                    <h4>查看所有案例</h4>
                    <p>返回主页面浏览完整案例列表</p>
                </a>
            </div>
        </div>
        
        <footer>
            <p>历史记录分析系统 &copy; 2023 | 案例编号: REC004</p>
        </footer>
    </div>
    
    <script>
        // 交互演示功能
        document.addEventListener('DOMContentLoaded', function() {
            // 选项卡功能
            const tabs = document.querySelectorAll('.demo-tab');
            const contents = document.querySelectorAll('.demo-content');
            
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-target');
                    
                    // 移除所有active类
                    tabs.forEach(t => t.classList.remove('active'));
                    contents.forEach(c => c.classList.remove('active'));
                    
                    // 添加active类
                    this.classList.add('active');
                    document.getElementById(targetId).classList.add('active');
                });
            });
            
            console.log('案例页面加载完成: PHP后端API接口设计');
        });
    </script>
</body>
</html>
